<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Insights from deep-diving into TypeScript - Alex Lawrence</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Insights from deep-diving into TypeScript" />
<meta property="og:description" content="Summary of insights from deep-diving into TypeScript" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.alex-lawrence.com/posts/insights-from-deep-diving-into-typescript/" />



<meta property="article:published_time" content="2021-03-03T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2021-03-03T00:00:00&#43;00:00"/>










<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Insights from deep-diving into TypeScript"/>
<meta name="twitter:description" content="Summary of insights from deep-diving into TypeScript"/>
<link rel="stylesheet" type="text/css" media="screen" href="https://www.alex-lawrence.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.alex-lawrence.com/css/main.css" />
	<link rel="stylesheet" type="text/css" href="https://www.alex-lawrence.com/css/index.css" />
	<link rel="stylesheet" type="text/css" href="https://www.alex-lawrence.com/css/dark.css" media="(prefers-color-scheme: dark)" />

	<script src="https://www.alex-lawrence.com/js/feather.min.js"></script>
	
	<script src="https://www.alex-lawrence.com/js/main.js"></script>
	<script src="https://www.alex-lawrence.com/js/index.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<base href="https://www.alex-lawrence.com/">
	<h1 class="site-title"><a href="https://www.alex-lawrence.com/">Alex Lawrence</a></h1>
	<div class="site-description"><h2>Full-Stack Developer, Technical Lead, Software Architect</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/alexlawrence" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/lx_lawrence" title="Twitter"><i data-feather="twitter"></i></a><a href="/posts/index.xml" title="RSS"><i data-feather="rss"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Profile</a>
			</li>
			
			<li>
				<a href="/resume">Resume</a>
			</li>
			
			<li>
				<a href="/posts">Posts</a>
			</li>
			
			<li>
				<a href="/book">Book</a>
			</li>
			
			<li>
				<a href="/contact">Contact</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Insights from deep-diving into TypeScript</h1>
			
				<div class="meta">
					Posted at Mar 3, 2021 &mdash;
					Reading time: 5 minutes
				</div>
			
		</div>

		<div class="markdown">
			

<p>This post summarizes some insights from my deep dive into TypeScript from when writing an appendix for <a href="https://leanpub.com/implementing-ddd-cqrs-and-event-sourcing">my book</a>. While I have been working with TypeScript for quite some time, most of the code I encountered was pretty trivial. The majority of the following aspects were new to me and helped me to understand the language better. Also, writing a lot of my book&rsquo;s code again in TypeScript allowed me to identify potential downsides.</p>

<h2 id="class-magic">Class magic</h2>

<p>TypeScript has a special support for the <code>class</code> keyword. For every class within the global scope (of a module), it implicitly defines an instance type with the same name. This enables to write things like <code>const user: User = new User()</code>. Unfortunately, this mechanism does not work for dynamically created classes or plain constructors. In such cases, the behavior must be emulated with the utility <code>InstanceType</code> and the keyword <code>typeof</code>. Interestingly, <code>export</code> and <code>import</code> statements combine same-named values and types.</p>

<p>The following code illustrates this behavior:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#ff79c6">class</span> StaticClass {}
<span style="color:#ff79c6">const</span> a: <span style="color:#8be9fd">StaticClass</span> <span style="color:#6272a4">/* instance type */</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> StaticClass(); <span style="color:#6272a4">/* constructor */</span>

<span style="color:#ff79c6">const</span> createClass <span style="color:#ff79c6">=</span> () <span style="color:#ff79c6">=&gt;</span> <span style="color:#ff79c6">class</span> {};
<span style="color:#ff79c6">const</span> DynamicClass <span style="color:#ff79c6">=</span> createClass(); <span style="color:#6272a4">/* no implicit type definition */</span>
<span style="color:#6272a4">// this does not work yet: const b: DynamicClass = new DynamicClass();
</span><span style="color:#6272a4"></span>
type DynamicClass <span style="color:#ff79c6">=</span> InstanceType<span style="color:#ff79c6">&lt;</span><span style="color:#ff79c6">typeof</span> DynamicClass<span style="color:#ff79c6">&gt;</span>; <span style="color:#6272a4">/* now there is a type */</span>
<span style="color:#ff79c6">const</span> b: <span style="color:#8be9fd">DynamicClass</span> <span style="color:#6272a4">/* instance type */</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> DynamicClass(); <span style="color:#6272a4">/* constructor */</span>

<span style="color:#ff79c6">export</span> {StaticClass, DynamicClass}; <span style="color:#6272a4">/* exports both constructors and types */</span></code></pre></div>
<p>The statement <code>type X = InstanceType&lt;typeof X&gt;</code> is logically equivalent to what TypeScript does automatically when encountering the <code>class</code> keyword.</p>

<h2 id="no-type-inference-for-members">No type inference for members</h2>

<p>For some implementations of an interface, the types of member attributes and member functions could be inferred. As example, when the interface <code>Logger</code> defines the function <code>log(message: string): void</code>, the implementation <code>ConsoleLogger</code> could just use the signature <code>log(message)</code>. TypeScript could infer that the function parameter is a string and the return value is <code>void</code>. For different reasons, this is currently not supported. All member attributes and member functions must be typed explicitly, independent of interfaces or base classes.</p>

<p>The next example illustrates the potential repetition due to this circumstance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#ff79c6">interface</span> Logger {
  logInfo(message: <span style="color:#8be9fd">String</span>)<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">void</span>;
  logWarning(message: <span style="color:#8be9fd">String</span>)<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">void</span>;
  logError(message: <span style="color:#8be9fd">String</span>)<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">void</span>;
}

<span style="color:#ff79c6">class</span> ConsoleLogger <span style="color:#ff79c6">implements</span> Logger {
  logInfo(message: <span style="color:#8be9fd">String</span>) { <span style="color:#6272a4">/* .. */</span> }
  logWarning(message: <span style="color:#8be9fd">String</span>) { <span style="color:#6272a4">/* .. */</span> }
  logError(message: <span style="color:#8be9fd">String</span>) { <span style="color:#6272a4">/* .. */</span> }
}</code></pre></div>
<h2 id="no-partial-type-inference">No partial type inference</h2>

<p>TypeScript can infer the types for type parameters from their usage. For example, the function <code>asArray&lt;T&gt;(item: T) { return [item]; }</code> can be invoked without specifying the type parameter, such as <code>asArray('foo')</code>. In this case, <code>T</code> is inferred to be of type <code>&quot;foo&quot;</code> (which extends <code>string</code>). However, this does not work for multiple type parameters, where only some should be inferred. One possible workaround is to split a function into multiple, with one having all type parameters to infer.</p>

<p>The following code shows a generic function to create object factories with pre-filled data:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#ff79c6">const</span> createFactory1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&lt;</span>R <span style="color:#ff79c6">extends</span> {}, P <span style="color:#ff79c6">extends</span> {}<span style="color:#ff79c6">&gt;</span>(prefilled: <span style="color:#8be9fd">P</span>) <span style="color:#ff79c6">=&gt;</span>
  (required: <span style="color:#8be9fd">R</span>) <span style="color:#ff79c6">=&gt;</span> ({...required, ...prefilled});
<span style="color:#6272a4">// requires to specify second type parameter, even though it could be inferred
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">const</span> createAdmin1 <span style="color:#ff79c6">=</span> createFactory1<span style="color:#ff79c6">&lt;</span>{email: <span style="color:#8be9fd">string</span>}, {admin: <span style="color:#8be9fd">true</span>}<span style="color:#ff79c6">&gt;</span>({admin: <span style="color:#8be9fd">true</span>});
<span style="color:#ff79c6">const</span> adminUser1 <span style="color:#ff79c6">=</span> createAdmin1({email<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;john@example.com&#39;</span>});

<span style="color:#ff79c6">const</span> createFactory2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&lt;</span>R <span style="color:#ff79c6">extends</span> {}<span style="color:#ff79c6">&gt;</span>() <span style="color:#ff79c6">=&gt;</span> <span style="color:#ff79c6">&lt;</span>P <span style="color:#ff79c6">extends</span> {}<span style="color:#ff79c6">&gt;</span>(prefilled: <span style="color:#8be9fd">P</span>) <span style="color:#ff79c6">=&gt;</span>
  (required: <span style="color:#8be9fd">R</span>) <span style="color:#ff79c6">=&gt;</span> ({...required, ...prefilled});
<span style="color:#6272a4">// first function specifies type parameter, for second function it is inferred
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">const</span> createAdmin2 <span style="color:#ff79c6">=</span> createFactory2<span style="color:#ff79c6">&lt;</span>{email: <span style="color:#8be9fd">string</span>}<span style="color:#ff79c6">&gt;</span>()({admin: <span style="color:#8be9fd">true</span>});
<span style="color:#ff79c6">const</span> adminUser2 <span style="color:#ff79c6">=</span> createAdmin2({email<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;jane@example.com&#39;</span>});</code></pre></div>
<p>The function <code>createFactory1()</code> requires to specify both type parameters, even though the second one could be inferred. The operation <code>createFactory2()</code> eliminates this issue by splitting the function into two individual operations.</p>

<h2 id="discriminating-unions-usage">Discriminating Unions usage</h2>

<p>Discriminating Unions are useful for working with heterogeneous sets of similar items, such as Domain Events. The mechanism allows to distinguish between multiple types using a discriminating field. Every item type uses a specific type for the field that makes it distinct. When processing an item with a union type, its type can be narrowed down based on the discriminating field. One downside of this mechanism is that it requires the code to be written in a specific way.</p>

<p>The next example compares a JavaScript implementation of an event handler to its TypeScript counterpart with Discriminating Unions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#6272a4">// JavaScript
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">const</span> handleEvent <span style="color:#ff79c6">=</span> ({type, data}) <span style="color:#ff79c6">=&gt;</span> { <span style="color:#6272a4">// early destructuring
</span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">if</span> (type <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;UserRegistered&#39;</span>)
    console.log(<span style="color:#f1fa8c">`new user with username: </span><span style="color:#f1fa8c">${</span>data.username<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>);
  <span style="color:#ff79c6">if</span> (type <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;UserLoggedIn&#39;</span>)
    console.log(<span style="color:#f1fa8c">`user logged in from device: </span><span style="color:#f1fa8c">${</span>data.device<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>);
};

<span style="color:#6272a4">// TypeScript
</span><span style="color:#6272a4"></span>type UserRegisteredEvent <span style="color:#ff79c6">=</span> {type<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;UserRegistered&#39;</span>, data<span style="color:#ff79c6">:</span> {username: <span style="color:#8be9fd">string</span>}};
type UserLoggedInEvent <span style="color:#ff79c6">=</span> {type<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;UserLoggedIn&#39;</span>, data<span style="color:#ff79c6">:</span> {device: <span style="color:#8be9fd">string</span>}};
type UserEvent <span style="color:#ff79c6">=</span> UserRegisteredEvent <span style="color:#ff79c6">|</span> UserLoggedInEvent;

<span style="color:#ff79c6">const</span> handleEvent <span style="color:#ff79c6">=</span> (event: <span style="color:#8be9fd">UserEvent</span>) <span style="color:#ff79c6">=&gt;</span> { <span style="color:#6272a4">// destructuring must not happen here
</span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">if</span> (event.type <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;UserRegistered&#39;</span>)
    console.log(<span style="color:#f1fa8c">`new user with username: </span><span style="color:#f1fa8c">${</span>event.data.username<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>);
  <span style="color:#ff79c6">if</span> (event.type <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;UserLoggedIn&#39;</span>)
    console.log(<span style="color:#f1fa8c">`user logged in from device: </span><span style="color:#f1fa8c">${</span>event.data.device<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>);
};</code></pre></div>
<p>When using TypeScript, a value with a Discriminating Union type must not be destructured before narrowing down its type.</p>

<h2 id="template-literal-types">Template Literal types</h2>

<p>Template Literal types are essentially Template Literals on a type level. They can be used to create string literal types that are the result of evaluating a template literal. The article <a href="https://davidtimms.github.io/programming-languages/typescript/2020/11/20/exploring-template-literal-types-in-typescript-4.1.html">&ldquo;Exploring Template Literal Types in TypeScript 4.1&rdquo; by David Timms</a> explains them in greater detail with advanced examples. One notable use case is the definition of message processing components, where individual message types are handled by specific operations.</p>

<p>The following example demonstrates this using the previous logger example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript">type MessageType <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;Info&#39;</span> <span style="color:#ff79c6">|</span> <span style="color:#f1fa8c">&#39;Warning&#39;</span> <span style="color:#ff79c6">|</span> <span style="color:#f1fa8c">&#39;Error&#39;</span>;

type Logger <span style="color:#ff79c6">=</span> {
  [k <span style="color:#ff79c6">in</span> MessageType <span style="color:#ff79c6">as</span> <span style="color:#f1fa8c">`log</span><span style="color:#f1fa8c">${</span>MessageType<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>]<span style="color:#ff79c6">:</span> (message: <span style="color:#8be9fd">string</span>) <span style="color:#ff79c6">=&gt;</span> <span style="color:#ff79c6">void</span>;
}

<span style="color:#ff79c6">class</span> ConsoleLogger <span style="color:#ff79c6">implements</span> Logger {
  logInfo(message: <span style="color:#8be9fd">String</span>) { <span style="color:#6272a4">/* .. */</span> }
  logWarning(message: <span style="color:#8be9fd">String</span>) { <span style="color:#6272a4">/* .. */</span> }
  logError(message: <span style="color:#8be9fd">String</span>) { <span style="color:#6272a4">/* .. */</span> }
}</code></pre></div>
<p>The type definition <code>Logger</code> iterates over the union type <code>MessageType</code> and defines one operation for each message type.</p>

<h2 id="don-t-let-typescript-get-into-your-way">Don&rsquo;t let TypeScript get into your way</h2>

<p>TypeScript is a powerful statically typed language. Many times, it is referred to as a &ldquo;superset of JavaScript&rdquo;. However, for some functionalities, it forces to write code in a specific way. For one, Discriminating Unions influence how destructuring assignments can be used. Also, the lack of partial type inference can necessitate to split up one function into multiple ones. While the benefits of TypeScript likely outweigh its potential downsides, it is still important to be aware of them.</p>

<p><a href="https://twitter.com/lx_lawrence/status/1367160115602849804">Discuss on Twitter</a></p>

		</div>

		<div class="post-tags">
			
				
			
		</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2020 Alex Lawrence |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>



<script>feather.replace()</script>
</body>
</html>
